<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ø§ÙŠØ¯Ø© Ø±Ù…Ø¶Ø§Ù† Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #1a472a; --gold-color: #c9a227; }
        body { font-family: 'Tajawal', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { max-width: 500px; width: 90%; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: var(--primary-color); margin-bottom: 30px; font-size: 24px; }
        .section { margin-bottom: 25px; }
        label { display: block; margin-bottom: 12px; font-weight: bold; color: #333; font-size: 14px; }
        
        /* Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØµÙˆØ± */
        .grid-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .grid-options img { width: 100%; height: 70px; object-fit: cover; cursor: pointer; border: 2px solid #eee; border-radius: 12px; transition: all 0.3s ease; }
        .grid-options img.selected { border-color: var(--gold-color); transform: scale(1.05); box-shadow: 0 5px 15px rgba(201, 162, 39, 0.2); }
        
        .calligraphy-options img { object-fit: contain; background: #fafafa; padding: 5px; box-sizing: border-box; }

        input, select { width: 100%; padding: 14px; border: 1.5px solid #eee; border-radius: 10px; font-family: 'Tajawal'; font-size: 14px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary-color); }
        
        .btn-generate { width: 100%; padding: 16px; background-color: var(--primary-color); color: white; border: none; border-radius: 12px; font-size: 16px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; }
        .btn-generate:hover { background-color: #12311d; opacity: 0.95; }

        #preview-container { margin-top: 30px; display: none; text-align: center; }
        canvas { max-width: 100%; height: auto; border-radius: 15px; border: 1px solid #ddd; }
        .btn-download { background-color: var(--gold-color); margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸŒ™ Ù…Ø¹Ø§ÙŠØ¯Ø© Ø±Ù…Ø¶Ø§Ù† Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>

    <div class="section">
        <label>1. Ø§Ø®ØªØ± Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</label>
        <div class="grid-options" id="bgOptions">
            <img src="https://cdn.jsdelivr.net/gh/imagesloads/images@main/img_e5c8e9f671e34ec7.png" data-src="bg1_full.jpg" class="selected">
            <img src="https://cdn.jsdelivr.net/gh/imagesloads/images@main/img_e5c8e9f671e34ec7.png" data-src="bg2_full.jpg">
            <img src="https://cdn.jsdelivr.net/gh/imagesloads/images@main/img_e5c8e9f671e34ec7.png" data-src="bg3_full.jpg">
        </div>
    </div>

    <div class="section">
        <label>2. Ø§Ø®ØªØ± Ø§Ù„Ù…Ø®Ø·ÙˆØ·Ø©:</label>
        <div class="grid-options calligraphy-options" id="calligraphyOptions">
            <img src="https://eid.moveed.net/images/scripts/ramadan/0036.png" class="selected">
            <img src="https://eid.moveed.net/images/scripts/ramadan/0036.png">
            <img src="https://eid.moveed.net/images/scripts/ramadan/0036.png">
        </div>
    </div>

    <div class="section">
        <label>3. Ø§Ø®ØªØ± Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ØªÙ‡Ù†Ø¦Ø©:</label>
        <select id="messageText">
            <option>Ø¨Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ù„ÙˆÙ„ Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ</option>
            <option>Ù…Ø¨Ø§Ø±Ùƒ Ø¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø´Ù‡Ø± ÙˆÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø®ÙŠØ±</option>
            <option>ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</option>
        </select>
    </div>

    <div class="section">
        <label>4. Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…:</label>
        <input type="text" id="empName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
    </div>

    <button class="btn-generate" onclick="generateCard()">Ø¹Ø±Ø¶ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© âœ¨</button>

    <div id="preview-container">
        <canvas id="cardCanvas" width="1080" height="1080"></canvas>
        <button class="btn-generate btn-download" onclick="downloadCard()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ğŸ“¥</button>
    </div>
</div>

<script>
    // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù†Ø§ØµØ±
    function bindSelection(id) {
        const imgs = document.querySelectorAll(`#${id} img`);
        imgs.forEach(img => {
            img.addEventListener('click', () => {
                document.querySelectorAll(`#${id} img`).forEach(i => i.classList.remove('selected'));
                img.classList.add('selected');
            });
        });
    }
    bindSelection('bgOptions');
    bindSelection('calligraphyOptions');

    async function generateCard() {
        const canvas = document.getElementById('cardCanvas');
        const ctx = canvas.getContext('2d');
        const name = document.getElementById('empName').value || "Ø²Ù…ÙŠÙ„Ù†Ø§ Ø§Ù„Ø¹Ø²ÙŠØ²";
        const message = document.getElementById('messageText').value;

        // Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± (Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø±ÙˆØ§Ø¨Ø·Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠØ©)
        const bgSrc = document.querySelector('#bgOptions img.selected').dataset.src;
        const calSrc = document.querySelector('#calligraphyOptions img.selected').dataset.src;

        const loadImg = (src) => new Promise((res) => {
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.src = src;
            img.onload = () => res(img);
        });

        const [bgImg, calImg] = await Promise.all([loadImg(bgSrc), loadImg(calSrc)]);

        // 1. Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ©
        ctx.drawImage(bgImg, 0, 0, 1080, 1080);

        // 2. Ø±Ø³Ù… Ø§Ù„Ù…Ø®Ø·ÙˆØ·Ø© (ØªÙˆØ³ÙŠØ·)
        const calW = 500;
        const calH = (calImg.height / calImg.width) * calW;
        ctx.drawImage(calImg, (1080 - calW) / 2, 300, calW, calH);

        // 3. ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø§Ø³Ù…
        ctx.textAlign = "center";
        ctx.fillStyle = "#ffffff"; 
        ctx.font = "40px Tajawal";
        ctx.fillText(message, 540, 700);

        ctx.fillStyle = "#c9a227"; // Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø§Ø³Ù…
        ctx.font = "bold 60px Tajawal";
        ctx.fillText(name, 540, 820);

        document.getElementById('preview-container').style.display = 'block';
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function downloadCard() {
        const link = document.createElement('a');
        link.download = 'Ramadan_Greeting.png';
        link.href = document.getElementById('cardCanvas').toDataURL();
        link.click();
    }
</script>

</body>
</html>
